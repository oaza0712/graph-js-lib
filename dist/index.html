<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-16">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Charts for children</title>
    <style>* {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
}

.chartMenu {
  width: 100vw;
  height: 40px;
  color: #36a2eb;
  background: #1a1a1a;
}

.chartMenu p {
  padding: 10px;
  font-size: 20px;
}

.chartCard {
  width: 100vw;
  height: calc(100vh - 40px);
  background: #36a2eb33;
  justify-content: center;
  align-items: center;
  display: flex;
}

.chartBox {
  width: 700px;
  background: #fff;
  border: 3px solid #36a2eb;
  border-radius: 20px;
  padding: 20px;
}

</style>
  </head>
  <body>
    <div class="chartMenu">
      <p>JS-lib for children data literacy</p>
    </div>

    <!--PieCharts-->
    <div class="chartCard">
      <div>
        <div>piePictogram</div>
        <canvas id="piePictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div>
        <div>pieTransition</div>
        <canvas id="pieTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div>
        <div>pieChart</div>
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <!--BarCharts-->

    <div class="chartCard">
      <div class="chartBox">
        <div>barPictogram</div>
        <canvas id="barPictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>barTransition</div>
        <canvas id="barTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>barChart</div>
        <canvas id="barChart"></canvas>
      </div>
    </div>

    <!--LineCharts-->
    <div class="chartCard">
      <div class="chartBox">
        <div>linePictogram</div>
        <canvas id="linePictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>lineTransition</div>
        <canvas id="lineTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>lineChart</div>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <div class="temp"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>//DEFINIRANJE TIPOVA DIJAGRAMA
let piePictogram = "piePictogram";
let pieTransition = "pieTransition";
let pieChart = "pieChart";
let barPictogram = "barPictogram";
let barTransition = "barTransition";
let barChart = "barChart";
let linePictogram = "linePictogram";
let lineTransition = "lineTransition";
let lineChart = "lineChart";
let Bar = {
    type: "bar",
    labels: [
        "Apples",
        "Oranges",
        "Bananas",
        "Strawberrys"
    ],
    values: [
        1,
        12.86,
        3,
        4
    ],
    unicode: [
        "\uD83C\uDF4F",
        "\uD83C\uDF4A",
        "\uD83C\uDF4C",
        "\uD83C\uDF53"
    ]
};
let Pie = {
    type: "pie",
    labels: [
        "Apples",
        "Oranges",
        "Bananas",
        "Strawberrys"
    ],
    values: [
        1,
        2,
        3,
        4
    ],
    unicode: [
        "\uD83C\uDF4F",
        "\uD83C\uDF4A",
        "\uD83C\uDF4C",
        "\uD83C\uDF53"
    ]
};
let Line = {
    type: "line",
    labels: [
        "first day",
        "second day",
        "third day",
        "fourth day"
    ],
    values: [
        1,
        2,
        5,
        7
    ],
    labelDataset: [
        "pickedApples"
    ],
    unicode: [
        "\uD83C\uDF4F",
        "\uD83C\uDF4A",
        "\uD83C\uDF4C",
        "\uD83C\uDF53"
    ]
};
//POZIV FUNKCIJE ZA RENDERING
KidChart(piePictogram, Pie);
KidChart(pieTransition, Pie);
KidChart(pieChart, Pie);
KidChart(linePictogram, Line);
KidChart(lineTransition, Line);
KidChart(lineChart, Line);
KidChart(barPictogram, Bar);
KidChart(barTransition, Bar);
KidChart(barChart, Bar);
// RENDERING FUNCTION
function KidChart(typeOfChart, userData) {
    //TRIMMING TO WHOLE NUMBERS
    for(let i = 0; i < userData.values.length; i++)userData.values[i] = Math.floor(userData.values[i]);
    //DEFAULT DATA VALUES
    var data = {
        labels: userData.labels,
        datasets: [
            {
                label: "Type of fruit",
                data: userData.values,
                backgroundColor: [
                    "rgba(93, 230, 0, 0.8)",
                    "rgba(233, 148, 0, 0.8)",
                    "rgba(255, 252, 0, 0.8)",
                    "rgba(255, 5, 5, 0.8)"
                ],
                borderColor: [
                    "rgba(93, 230, 0, 1)",
                    "rgba(233, 148, 0, 1)",
                    "rgba(255, 252, 0, 1)",
                    "rgba(255, 5, 5, 1)"
                ],
                borderWidth: 1
            }
        ]
    };
    if (typeOfChart == "barPictogram" || typeOfChart == "piePictogram") var data = {
        labels: userData.labels,
        datasets: [
            {
                label: "Type of fruit",
                data: userData.values,
                backgroundColor: "rgba(255, 255, 255, 0.1)",
                borderColor: [
                    "rgba(93, 230, 0, 1)",
                    "rgba(233, 148, 0, 1)",
                    "rgba(255, 252, 0, 1)",
                    "rgba(255, 5, 5, 1)"
                ],
                borderWidth: 5
            }
        ]
    };
    if (typeOfChart == "lineChart") data = {
        labels: userData.labels,
        datasets: [
            {
                label: userData.labelDataset[0],
                data: userData.values,
                fill: false,
                backgroundColor: "rgba(93, 230, 0, 0.8)",
                borderColor: "rgba(93, 230, 0, 0.8)"
            }
        ]
    };
    if (typeOfChart == "linePictogram") data = {
        labels: userData.labels,
        datasets: [
            {
                label: userData.labelDataset[0],
                data: userData.values,
                fill: false,
                backgroundColor: "rgba(255, 255, 255, 0.1)",
                borderColor: "rgba(255, 255, 255, 0.1)"
            }
        ]
    };
    //PLUGIN FOR EMOJI RENDERING
    const plugin = {
        id: "plugin",
        afterDatasetDraw (chart, args, options) {
            const { ctx , chartArea: { top , bottom , left , right , width , height  } , scales: { x , y  }  } = chart;
            ctx.save();
            if (typeOfChart == "piePictogram" || typeOfChart == "pieTransition") {
                //CALCULATING WHICH PERCENTAGE OF PIE CHART EACH VALUE TAKES
                let angles = [];
                let sum = 0;
                for(let i = 0; i < userData.values.length; i++)sum += userData.values[i];
                for(let i1 = 0; i1 < userData.values.length; i1++)angles[i1] = userData.values[i1] / sum * 6.2831;
                let current_angle = 4.71238898038 + angles[0] / 2;
                let max_width = 30;
                for(let i2 = 0; i2 < userData.values.length; i2++){
                    let temp = Math.min(width / 3 / userData.values[i2] - 5, 30);
                    let size = temp;
                    //DISABLING TOO SMALLL ICONS
                    if (temp < 0) {
                        size = Math.max(temp, 1);
                        console.log("Icons don't fit on the chart.");
                        userData.values[i2] = (width / 2 - Math.ceil(Math.sqrt(0.5 * size * 0.5 * size + max_width * max_width / 4))) / 6;
                    }
                    let a = 0.5 * size * 0.5 * size;
                    let b = max_width * max_width;
                    let radius = width / 2 - Math.ceil(Math.sqrt(a + b / 4));
                    for(let j = 0; j < userData.values[i2]; j++){
                        ctx.font = `${size}px Arial`;
                        ctx.fillText(userData.unicode[i2], radius * Math.cos(current_angle) + width / 2 - size / 2, radius * Math.sin(current_angle) + width / 2 + max_width / 2, max_width);
                        radius -= size + 5;
                    }
                    current_angle += angles[i2] / 2 + angles[i2 + 1] / 2;
                }
            }
            if (typeOfChart == "barTransition" || typeOfChart == "barPictogram") {
                let size1 = (y.getPixelForValue(0) - y.getPixelForValue(1)) / 1.5;
                for(let i3 = 0; i3 < userData.values.length; i3++)for(let j1 = 0; j1 < userData.values[i3]; j1++){
                    ctx.font = `${size1}px Arial`;
                    ctx.fillText(userData.unicode[i3], x.getPixelForValue(i3) - size1 / 2, y.getPixelForValue(j1 + 1) + size1 / 0.87, size1);
                }
            }
            if (typeOfChart == "lineTransition" || typeOfChart == "linePictogram") {
                let size2 = (y.getPixelForValue(0) - y.getPixelForValue(1)) / 2.5;
                for(let i4 = 0; i4 < userData.values.length; i4++)for(let j2 = 0; j2 < userData.values[i4]; j2++){
                    let between = y.getPixelForValue(0) - y.getPixelForValue(userData.values[i4]);
                    ctx.font = `${size2}px Arial`;
                    if (j2 == 0) ctx.fillText(userData.unicode[0], x.getPixelForValue(i4) - size2 / 2, y.getPixelForValue(j2 + 1.5) + size2, size2);
                    else ctx.fillText(userData.unicode[0], x.getPixelForValue(i4) - size2 / 2, y.getPixelForValue(j2 + 1) + size2 * 0.5, size2);
                }
            }
        }
    };
    var display = false;
    if (typeOfChart == "pieChart" || typeOfChart == "lineChart") display = true;
    // config
    const config = {
        type: userData.type,
        data,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        },
        options: {
            plugins: {
                legend: {
                    display: display
                }
            }
        },
        plugins: [
            plugin
        ]
    };
    // render init block
    const myKidChart = new Chart(document.getElementById(typeOfChart), config);
}

</script>
  <script src="/graph-js-lib.59712999.js"></script></body>
</html>
