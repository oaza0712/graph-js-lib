<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-16" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Charts for children</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        font-family: sans-serif;
      }
      .chartMenu {
        width: 100vw;
        height: 40px;
        background: #1a1a1a;
        color: rgba(54, 162, 235, 1);
      }
      .chartMenu p {
        padding: 10px;
        font-size: 20px;
      }
      .chartCard {
        width: 100vw;
        height: calc(100vh - 40px);
        background: rgba(54, 162, 235, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .chartBox {
        width: 700px;
        padding: 20px;
        border-radius: 20px;
        border: solid 3px rgba(54, 162, 235, 1);
        background: white;
      }
    </style>
  </head>
  <body>
    <div class="chartMenu">
      <p>JS-lib for children data literacy</p>
    </div>

    <!--PieCharts-->
    <div class="chartCard">
      <div>
        <div>piePictogram</div>
        <canvas id="piePictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div>
        <div>pieTransition</div>
        <canvas id="pieTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div>
        <div>pieChart-done</div>
        <canvas id="pieChart"></canvas>
      </div>
    </div>

    <!--BarCharts-->

    <div class="chartCard">
      <div class="chartBox">
        <div>barPictogram</div>
        <canvas id="barPictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>barTransition-done</div>
        <canvas id="barTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>barChart-done</div>
        <canvas id="barChart"></canvas>
      </div>
    </div>

    <!--LineCharts-->
    <div class="chartCard">
      <div class="chartBox">
        <div>linePictogram</div>
        <canvas id="linePictogram"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>lineTransition</div>
        <canvas id="lineTransition"></canvas>
      </div>
    </div>

    <div class="chartCard">
      <div class="chartBox">
        <div>lineChart-done</div>
        <canvas id="lineChart"></canvas>
      </div>
    </div>

    <script
      type="text/javascript"
      src="https://cdn.jsdelivr.net/npm/chart.js"
    ></script>
    <script>
      //DEFINIRANJE TIPOVA DIJAGRAMA
      let barPictogram = "barPictogram";
      let barTransition = "barTransition";
      let barChart = "barChart";

      let piePictogram = "piePictogram";
      let pieTransition = "pieTransition";
      let pieChart = "pieChart";

      let linePictogram = "linePictogram";
      let lineTransition = "lineTransition";
      let lineChart = "lineChart";

      let Bar = {
        type: "bar",
        labels: ["Apples", "Oranges", "Bananas", "Strawberrys"],
        values: [1, 2, 3, 4],
        unicode: [
          "\uD83C\uDF4F",
          "\uD83C\uDF4A",
          "\uD83C\uDF4C",
          "\uD83C\uDF53",
        ],
      };
      let Pie = {
        type: "pie",
        labels: ["Apples", "Oranges", "Bananas", "Strawberrys"],
        values: [1, 2, 3, 4],
        unicode: [
          "\uD83C\uDF4F",
          "\uD83C\uDF4A",
          "\uD83C\uDF4C",
          "\uD83C\uDF53",
        ],
      };

      let lineGraphValues = {
        pickedApples: [1, 2, 3, 4],
        pickedOranges: [4, 9, 2, 7],
        pickedBananas: [14, 2, 2, 5],
        pickedStrawberrys: [8, 3, 6, 6],
      };
      let Line = {
        type: "line",
        labels: ["first day", "second day", "third day", "fourth day"],
        values: [1, 2, 3, 4],
        labelDataset: [
          "pickedApples",
          "pickedOranges",
          "pickedBananas",
          "pickedStrawberrys",
        ],
        unicode: [
          "\uD83C\uDF4F",
          "\uD83C\uDF4A",
          "\uD83C\uDF4C",
          "\uD83C\uDF53",
        ],
      };
      let lineTrans = {
        type: "line",
        labels: ["first day", "second day", "third day", "fourth day"],
        values: [1, 2, 3, 4],
        labelDataset: ["pickedApples"],
        unicode: ["\uD83C\uDF4F"],
      };

      //POZIV FUNKCIJE ZA RENDERING
      KidChart(piePictogram, Pie);
      KidChart(pieTransition, Pie);
      KidChart(pieChart, Pie);

      KidChart(linePictogram, Line);
      KidChart(lineTransition, lineTrans);
      KidChart(lineChart, Line);

      KidChart(barPictogram, Bar);
      KidChart(barTransition, Bar);
      KidChart(barChart, Bar);

      // RENDERING FUNCTION
      function KidChart(typeOfChart, userData) {
        //DEFAULT DATA VALUES
        var data = {
          labels: userData.labels,
          datasets: [
            {
              label: "Type of fruit",
              data: userData.values,
              backgroundColor: [
                "rgba(93, 230, 0, 0.8)",
                "rgba(233, 148, 0, 0.8)",
                "rgba(255, 252, 0, 0.8)",
                "rgba(255, 5, 5, 0.8)",
              ],
              borderColor: [
                "rgba(93, 230, 0, 1)",
                "rgba(233, 148, 0, 1)",
                "rgba(255, 252, 0, 1)",
                "rgba(255, 5, 5, 1)",
              ],
              borderWidth: 1,
            },
          ],
        };

        if (typeOfChart == "barPictogram") {
          var data = {
          labels: userData.labels,
          datasets: [
            {
              label: "Type of fruit",
              data: userData.values,
              backgroundColor: "rgba(255, 255, 255, 0.1)",
                borderColor: "rgba(255, 255, 255, 0.1)",
              borderWidth: 1,
            },
          ],
        };
        }

        if (typeOfChart == "lineChart") {
          data = {
            labels: userData.labels,
            datasets: [
              {
                label: userData.labelDataset[0],
                data: userData.values, //userData.values.pickedApples,
                fill: false,
                backgroundColor: "rgba(93, 230, 0, 0.8)",
                borderColor: "rgba(93, 230, 0, 0.8)",
              },
            ],
          };
        }

        if (typeOfChart == "linePictogram") {
          data = {
            labels: userData.labels,
            datasets: [
              {
                label: userData.labelDataset[0],
                data: userData.values, //userData.values.pickedApples,
                fill: false,
                backgroundColor: "rgba(255, 255, 255, 0.1)",
                borderColor: "rgba(255, 255, 255, 0.1)",
              },
            ],
          };
        }

        //PLUGIN FOR EMOJI RENDERING
        const plugin = {
          id: "plugin",
          afterDatasetDraw(chart, args, options) {
            const {
              ctx,
              chartArea: { top, bottom, left, right, width, height },
              scales: { x, y },
            } = chart;

            ctx.save();
            if (typeOfChart == "piePictogram") {
              for (let i = 0; i < userData.values.length; i++) {
                for (let j = 0; j < userData.values[i]; j++) {
                  ctx.fillText(
                    userData.unicode[i],
                    10, // x.getPixelForValue(i) - 12,
                    10, // y.getPixelForValue(j + 1),
                    30
                  );
                }
              }
            }

            if (
              typeOfChart == "barTransition" ||
              typeOfChart == "barPictogram"
            ) {
            
              let size = y.getPixelForValue(0)-y.getPixelForValue(1)-30
              for (let i = 0; i < userData.values.length; i++) {
                for (let j = 0; j < userData.values[i]; j++) {
                  
                  ctx.font = `${size}px Arial`
                  ctx.fillText(
                    userData.unicode[i],
                    x.getPixelForValue(i) - size/2,
                    y.getPixelForValue(j+0.3),
                    size
                  );
                }
              }
            }

            if (
              typeOfChart == "lineTransition" ||
              typeOfChart == "linePictogram"
            ) {
              let size = y.getPixelForValue(0)-y.getPixelForValue(1)-80
              for (let i = 0; i < userData.values.length; i++) {
                for (let j = 0; j < userData.values[i]; j++) {
                  ctx.font = `${size}px Arial`
                  ctx.fillText(
                    userData.unicode[0],
                    x.getPixelForValue(i) - size/2,
                    y.getPixelForValue(j+1) + size/4,
                    size
                  );
                }
              }
            }

            if (typeOfChart == "piePictogram") {
              console.log("PIE", ctx);
            }
          },
        };

        var display = false;
        if (typeOfChart == "pieChart" || typeOfChart == "lineChart") {
          display = true;
        }
        // config
        const config = {
          type: userData.type,
          data,
          options: {
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
          options: {
            plugins: {
              legend: {
                display: display,
              },
            },
            onClick: (evt) => {
              if (typeOfChart == "piePictogram") {
                var elements = myKidChart.getElementsAtEventForMode(
                  evt,
                  "index",
                  { intersect: true },
                  false
                );
                // elements[0].fillText(userData.unicode[0],
                //30,
                //   30,
                //  30
                //);
                var index = elements[0].index;
                console.log("ELEMENTS[0] ", elements[0]);
              }
            },
          },
          plugins: [plugin],
        };

        // render init block

        const myKidChart = new Chart(
          document.getElementById(typeOfChart),
          config
        );
      }
    </script>
  </body>
</html>
